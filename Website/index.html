<!DOCTYPE html>
<html>

<head>
    <script src='/js/d3.min.js'></script>
    <script>
    d3.selection.prototype.union = function(that) {
        if (that instanceof d3.selection) {
            var newselection = d3.select(null); //ensure the correct prototype
            newselection.splice(0, 1); //empty the selection      
            [].push.apply(newselection, this); //push in this selection, without loosing the prototype 
            [].push.apply(newselection, that); //push in that selection, without loosing the prototype
            return newselection;
        } else {
            throw new Error("Can only union with another d3 selection");
        }
    };
    </script>
    <link rel='stylesheet' type='text/css' href='/css/styles.css'>
</head>

<body>
    <svg class='chart'>
    </svg>
    <script>
    var data = [{
        title: "ABC",
        values: [0, 6]
    }, {
        title: "B",
        values: [1, 5]
    }, {
        title: "C",
        values: [2, 4]
    }];

    var centerOffset = 20 * d3.max(data.map(function(d) {
        return d.title.length;
    })) + 20;
    var barHeight = 40;
    var barSpacing = 10;

    var width = 320;
    var height = data.length * barHeight;

    var halfWidth = width / 2;

    var chart = d3.select('.chart')
        .attr("width", width)
        .attr("height", height);

    var row = chart.selectAll("g")
        .data(data)
        .enter()
        .append("g");
    var leftBar = row
        .append("rect")
        .classed('bar-left', true);
    var rightBar = row
        .append("rect")
        .classed('bar-right', true);;
    var bars = leftBar.union(rightBar)
        .classed('bar', true)
        .attr('width', function(d, i, a) {
            var xScale = d3.scale.linear()
                .domain([0, d3.max(d.values)])
                .range([0, halfWidth - centerOffset])
            return xScale(d.values[a]);
        })
        .attr('height', barHeight - barSpacing)
        .attr('y', function(d, i, a) {
            return i * barHeight;
        });
    leftBar.attr('x', function(d, i, a) {
        var xScale = d3.scale.linear()
            .domain([0, d3.max(d.values)])
            .range([0, halfWidth - centerOffset])
        return halfWidth - xScale(d.values[a]) - centerOffset;
    });
    rightBar.attr('x', halfWidth + centerOffset);

    row.append('text')
        .classed('category-label', true)
        .attr("x", halfWidth)
        .attr("y", function(d, i, a) {
            return (i + 0.5) * barHeight;
        })
        .attr("dy", ".35em")
        .text(function(d, i, a) {
            return d.title;
        })
    </script>
</body>

</html>
